---
id: 8e0de798-3a0c-4be7-a522-d38fc133766d
title: 'Supporting multiple TLDs in Laravel Valet'
subtitle: 'Run your apps on multiple TLDs without the hassle.'
published: true
---



### Supporting multiple TLDs in Laravel Valet

[Valet](https://laravel.com/docs/master/valet) is great.

Occasionally though I need an app to respond on a different TLD to the default one. And there are even times when it makes sense to have an app respond on multiple TLDs (e.g. to prove some multi-domain functionality).

You may have some secure assets hosted by a third-party that requires domain verification (FontAwesome Pro). In development, that may mean it’s easier to be using the same domain as other devs on the team than add loads of different dev domains to the service’s whitelist.

In the current release of Valet, this kind of functionality isn’t natively available. Even in third-party packages like Valet+, this isn’t supported. But with a few quick changes it’s easily possible. Let me show you how.

### Dnsmasq

First we’ll need to update the Dnsmasq config so that it will handle multiple TLDs.

Turns out this is really easy. Valet holds some config in `~/.config/valet/dnsmasq.conf`.

In there we just need to add some config for each TLD we want to support. Add the following two lines for every TLD you want to support. Replace `<strong class="markup--strong markup--p-strong">{tld}</strong>` with the TLD, unsurprisingly.

```
<pre class="graf graf--pre graf-after--p" id="dac9" name="dac9">address=/<strong class="markup--strong markup--pre-strong">{tld}</strong>/127.0.0.1<br></br>listen-address=127.0.0.1
```

Then restart Dnsmasq:

```
<pre class="graf graf--pre graf-after--p" id="6bff" name="6bff">sudo brew services restart dnsmasq
```

### Valet

Now we just need to update the Valet code to support multiple domains.

Firstly, we’re going to add some values to our `~/.config/valet/config.json`. I’ve opted for simply adding keys rather than changing any existing one. I’ve added a `tlds` array. This will be used later.

```
<pre class="graf graf--pre graf-after--p" id="c5c2" name="c5c2">{<br></br>    ...<br></br>    "tlds": [<br></br>         "tld1",<br></br>         "tld2"<br></br>    ]<br></br>}
```

Then we just need to edit some Valet files and run some commands.

All of these edits I’m making directly in my globally-installed Valet (`~/.composer/vendor/laravel/valet/`).

```
<pre class="graf graf--pre graf-after--p" id="bd53" name="bd53"><strong class="markup--strong markup--pre-strong">// server.php, line 70</strong><br></br>$siteName = basename(<br></br>    // Filter host to support wildcard dns feature<br></br>    valet_support_wildcard_dns($_SERVER['HTTP_HOST']),<br></br>    '.'.$tld<br></br>);
```

```
<pre class="graf graf--pre graf-after--pre" id="c211" name="c211"><strong class="markup--strong markup--pre-strong">// change to:</strong><br></br><strong class="markup--strong markup--pre-strong">foreach ($valetConfig['tlds'] as $tld) {</strong><br></br><strong class="markup--strong markup--pre-strong">    if (strpos($_SERVER['HTTP_HOST'], '.'.$tld) === false) {<br></br>        continue;<br></br>    }</strong>
```

```
<pre class="graf graf--pre graf-after--pre" id="c5fd" name="c5fd">    $siteName = basename(<br></br>        // Filter host to support wildcard dns feature<br></br>        valet_support_wildcard_dns($_SERVER['HTTP_HOST']),<br></br>        '.'.$tld<br></br>    );<strong class="markup--strong markup--pre-strong"><br></br>}</strong>
```

This just allows the server to respond to whichever one of the TLDs we want to support.

Now let’s update the CLI so we can generate and remove SSL certs for all of the TLDs (`valet secure` and `valet unsecure` commands). Firstly, `secure`:

```
<pre class="graf graf--pre graf-after--p" id="05ec" name="05ec"><strong class="markup--strong markup--pre-strong">// cli/valet.php, line 145, secure command<br></br></strong>$app->command('secure [domain]', function ($domain = null) {<br></br>    $url = ($domain ?: Site::host(getcwd())).'.'.Configuration::read()['tld'];
```

```
<pre class="graf graf--pre graf-after--pre" id="be7b" name="be7b">    Site::secure($url);
```

```
<pre class="graf graf--pre graf-after--pre" id="0c3c" name="0c3c">    Nginx::restart();
```

```
<pre class="graf graf--pre graf-after--pre" id="bff4" name="bff4">    info('The ['.$url.'] site has been secured with a fresh TLS certificate.');<br></br>})->descriptions('Secure the given domain with a trusted TLS certificate');
```

```
<pre class="graf graf--pre graf-after--pre" id="7bfb" name="7bfb"><strong class="markup--strong markup--pre-strong">// change to:</strong><br></br>$app->command('secure [domain]', function ($domain = null) {<br></br>    <strong class="markup--strong markup--pre-strong">$urls = [];</strong>
```

```
<pre class="graf graf--pre graf-after--pre" id="db20" name="db20">    <strong class="markup--strong markup--pre-strong">foreach (Configuration::read()['tlds'] as $tld) {</strong><br></br>        $url = ($domain ?: Site::host(getcwd())).'.'.<strong class="markup--strong markup--pre-strong">$tld</strong>;
```

```
<pre class="graf graf--pre graf-after--pre" id="27fd" name="27fd">        Site::secure($url);
```

```
<pre class="graf graf--pre graf-after--pre" id="c26d" name="c26d">        <strong class="markup--strong markup--pre-strong">$urls[] = $url;<br></br>    }</strong>
```

```
<pre class="graf graf--pre graf-after--pre" id="1e0a" name="1e0a">    Nginx::restart();
```

```
<pre class="graf graf--pre graf-after--pre" id="bf73" name="bf73">    <strong class="markup--strong markup--pre-strong">$urls = implode(', ', $urls);</strong>
```

```
<pre class="graf graf--pre graf-after--pre" id="fe88" name="fe88">    info('The ['.<strong class="markup--strong markup--pre-strong">$urls</strong>.'] site has been secured with a fresh TLS certificate.');<br></br>})->descriptions('Secure the given domain with a trusted TLS certificate');
```

And now the `unsecure` command:

```
<pre class="graf graf--pre graf-after--p" id="80ba" name="80ba"><strong class="markup--strong markup--pre-strong">// cli/valet.php, line 158, unsecure command<br></br></strong>$app->command('unsecure [domain]', function ($domain = null) {<br></br>    $url = ($domain ?: Site::host(getcwd())).'.'.Configuration::read()['tld'];
```

```
<pre class="graf graf--pre graf-after--pre" id="1428" name="1428">Site::unsecure($url);
```

```
<pre class="graf graf--pre graf-after--pre" id="9d20" name="9d20">Nginx::restart();
```

```
<pre class="graf graf--pre graf-after--pre" id="557a" name="557a">info('The ['.$url.'] site  will now serve traffic over HTTP.');<br></br>})->descriptions('Stop serving the given domain over HTTPS and remove the trusted TLS certificate');
```

```
<pre class="graf graf--pre graf-after--pre" id="5594" name="5594"><strong class="markup--strong markup--pre-strong">// change to:</strong><br></br>$app->command('secure [domain]', function ($domain = null) {<br></br>    <strong class="markup--strong markup--pre-strong">$urls = [];</strong>
```

```
<pre class="graf graf--pre graf-after--pre" id="e773" name="e773"><strong class="markup--strong markup--pre-strong">    foreach (Configuration::read()['tlds'] as $tld) {</strong><br></br>        $url = ($domain ?: Site::host(getcwd())).'.'.<strong class="markup--strong markup--pre-strong">$tld</strong>;
```

```
<pre class="graf graf--pre graf-after--pre" id="3221" name="3221">        Site::secure($url);
```

```
<pre class="graf graf--pre graf-after--pre" id="d44b" name="d44b"><strong class="markup--strong markup--pre-strong">        $urls[] = $url;<br></br>    }</strong>
```

```
<pre class="graf graf--pre graf-after--pre" id="bec4" name="bec4">    Nginx::restart();
```

```
<pre class="graf graf--pre graf-after--pre" id="279f" name="279f"><strong class="markup--strong markup--pre-strong">    $urls = implode(', ', $urls);</strong>
```

```
<pre class="graf graf--pre graf-after--pre" id="c1af" name="c1af">    info('The ['.<strong class="markup--strong markup--pre-strong">$urls</strong>.'] site will now serve traffic over HTTP.');<br></br>})->descriptions('Stop serving the given domain over HTTPS and remove the trusted TLS certificate');
```

Finally, run the following command:

```
<pre class="graf graf--pre graf-after--p" id="c5b4" name="c5b4">valet restart
```

Enjoy!

